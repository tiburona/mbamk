===============================
My Brain and Me
===============================

 Cloudformation templates for AWS Deployment
----------

The yaml files are based on ECS Cloudformation stack templates provided by another project (see [here](https://github.com/nathanpeck/ecs-cloudformation)). The stacks are based on the first two architectures listed in the link (the public networked service with public load balancer and the privately networked service with public load balancer). The former is used for testing/debugging/development via providing SSH access to the created EC2 instances, and the latter will eventually be used for the production environment.

This project differs from the above mentioned stacks in that it adds additional 3 container services to stack. The four services are:
1. JATOS (Just Another Tool for Online Studies) attached to public load balancer and autoscaling.  
2. MBaM Flask app attached to public load balancer and autoscaling.  
3. Redis run as a DAEMON service (one service instance per EC2 instance). The celery workers use the redis server on each EC2 host.  
4. Celery worker attached to an autoscaling group.  

The stack also create an EFS that mounts persistance storage for JATOS and MBaM directory within each EC2 instance at /efs/jatos/study_assets_root and /efs/mbam/user-data respectively.

The stack also provisions the public application load balancer with SSL and adds CNAME records pointing the URLs ENVIRONMENTNAME.mybrainandme.org and jatos-ENVIRONMENTNAME.mybrainandme.org to the created public load balancer. ENVIRONMENTNAME is a parameter that is input to the stack upon deployment.  

IMPORTANT: The resources generated by these templates should NOT be changed manually outside of Cloudformation! Doing so will likely cause errors and prevent updates and changes to the stack.  

To create the stack, run the

  `master-template.yaml`

using the Create Stack button on the AWS Cloudformation console. Upload the file or point the file to the S3 bucket location (i.e. https://mbam-cfn-templates.s3.amazonaws.com/master-template.yaml). You will likely need permissions to access the S3 bucket and also the AWS ECR that contains the MBaM Flask App container.
